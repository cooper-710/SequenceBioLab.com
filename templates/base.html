<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sequence - Scouting Report Generator{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='sequence-logo.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='dropdown-enhancer.js') }}" defer></script>
    {% block extra_head %}{% endblock %}
</head>
<body data-theme="{{ app_theme|default('dark') }}">
    {% set user_authenticated = session.get('user_id') %}
    <div class="app-container{% if not user_authenticated %} app-container--unauth{% endif %}">
        {% if user_authenticated %}
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                        <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
                    </button>
                    <div class="logo-container">
                        <img src="{{ url_for('static', filename='sequence-logo.png') }}" alt="Sequence Logo" class="logo">
                    </div>
                    <h2 class="sidebar-title">Sequence BioLab</h2>
                    <p class="sidebar-greeting">
                        Hello {{ (session.get('first_name', '') ~ ' ' ~ session.get('last_name', ''))|trim }}
                    </p>
                </div>
                
                <nav class="sidebar-nav">
                    {% if session.get('is_admin') %}
                    <a href="{{ url_for('pages.home') }}" class="nav-item {% if request.endpoint == 'pages.home' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-house-chimney"></i></span>
                        <span class="nav-text">Home</span>
                    </a>
                    <a href="{{ url_for('pages.admin_dashboard') }}" class="nav-item {% if request.endpoint == 'pages.admin_dashboard' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-shield-halved"></i></span>
                        <span class="nav-text">Admin</span>
                    </a>
                    <a href="{{ url_for('pages.data_refresh') }}" class="nav-item {% if request.endpoint == 'pages.data_refresh' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-database"></i></span>
                        <span class="nav-text">Data Refresh</span>
                    </a>
                    <div class="nav-divider"></div>
                    <a href="{{ url_for('pages.gameday') }}" class="nav-item {% if request.endpoint == 'pages.gameday' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-trophy"></i></span>
                        <span class="nav-text">Gameday</span>
                    </a>
                    <a href="{{ url_for('pages.schedule') }}" class="nav-item {% if request.endpoint == 'pages.schedule' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-calendar-days"></i></span>
                        <span class="nav-text">Schedule</span>
                    </a>
                    <a href="{{ url_for('pages.live_scores') }}" class="nav-item {% if request.endpoint == 'pages.live_scores' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-baseball-ball"></i></span>
                        <span class="nav-text">Live Scores</span>
                    </a>
                    <a href="{{ url_for('scouting_report') }}" class="nav-item {% if request.endpoint == 'scouting_report' or request.endpoint == 'pages.scouting_report' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-clipboard-user"></i></span>
                        <span class="nav-text">Scouting Reports</span>
                    </a>
                    <a href="{{ url_for('pitchers_report') }}" class="nav-item {% if request.endpoint == 'pitchers_report' or request.endpoint == 'pages.pitchers_report' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-baseball"></i></span>
                        <span class="nav-text">Pitcher's Reports</span>
                    </a>
                    <a href="{{ url_for('player_database') }}" class="nav-item {% if request.endpoint == 'player_database' or request.endpoint == 'pages.player_database' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-magnifying-glass"></i></span>
                        <span class="nav-text">Player Database</span>
                    </a>
                    <a href="{{ url_for('visuals') }}" class="nav-item {% if request.endpoint == 'visuals' or request.endpoint == 'pages.visuals' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                        <span class="nav-text">Visuals</span>
                    </a>
                    <a href="{{ url_for('pitchviz') }}" class="nav-item {% if request.endpoint == 'pitchviz' or request.endpoint == 'pages.pitchviz' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-wave-square"></i></span>
                        <span class="nav-text">PitchViz</span>
                    </a>
                    <a href="{{ url_for('mocap') }}" class="nav-item {% if request.endpoint == 'mocap' or request.endpoint == 'pages.mocap' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-person-running"></i></span>
                        <span class="nav-text">Mocap</span>
                    </a>
                    <a href="{{ url_for('workouts') }}" class="nav-item {% if request.endpoint == 'workouts' or request.endpoint == 'pages.workouts' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-dumbbell"></i></span>
                        <span class="nav-text">Workouts</span>
                    </a>
                    <a href="{{ url_for('journaling') }}" class="nav-item {% if request.endpoint == 'journaling' or request.endpoint == 'pages.journaling' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-pen-to-square"></i></span>
                        <span class="nav-text">Journaling</span>
                    </a>
                    <a href="{{ url_for('pages.matchups') }}" class="nav-item {% if request.endpoint == 'pages.matchups' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-crosshairs"></i></span>
                        <span class="nav-text">Matchups</span>
                    </a>
                    <a href="{{ url_for('contractviz') }}" class="nav-item {% if request.endpoint == 'contractviz' or request.endpoint == 'pages.contractviz' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-file-contract"></i></span>
                        <span class="nav-text">ContractViz</span>
                    </a>
                    <div class="nav-divider"></div>
                    <a href="{{ url_for('pages.profile_settings') }}" class="nav-item {% if request.endpoint == 'pages.profile_settings' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-user-gear"></i></span>
                        <span class="nav-text">Profile Settings</span>
                    </a>
                    <a href="{{ url_for('settings.settings_page') }}" class="nav-item {% if request.endpoint == 'settings.settings_page' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-sliders"></i></span>
                        <span class="nav-text">Settings</span>
                    </a>
                    <div class="nav-divider"></div>
                    {% else %}
                    <a href="{{ url_for('pages.home') }}" class="nav-item {% if request.endpoint == 'pages.home' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-house-chimney"></i></span>
                        <span class="nav-text">Home</span>
                    </a>
                    <a href="{{ url_for('pages.gameday') }}" class="nav-item {% if request.endpoint == 'pages.gameday' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-trophy"></i></span>
                        <span class="nav-text">Gameday</span>
                    </a>
                    <a href="{{ url_for('pages.schedule') }}" class="nav-item {% if request.endpoint == 'pages.schedule' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-calendar-days"></i></span>
                        <span class="nav-text">Schedule</span>
                    </a>
                    <a href="{{ url_for('pages.live_scores') }}" class="nav-item {% if request.endpoint == 'pages.live_scores' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-baseball-ball"></i></span>
                        <span class="nav-text">Live Scores</span>
                    </a>
                    <a href="{{ url_for('player_database') }}" class="nav-item {% if request.endpoint == 'player_database' or request.endpoint == 'pages.player_database' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-magnifying-glass"></i></span>
                        <span class="nav-text">Player Database</span>
                    </a>
                    <a href="{{ url_for('mocap') }}" class="nav-item {% if request.endpoint == 'mocap' or request.endpoint == 'pages.mocap' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-person-running"></i></span>
                        <span class="nav-text">Mocap</span>
                    </a>
                    <a href="{{ url_for('pitchviz') }}" class="nav-item {% if request.endpoint == 'pitchviz' or request.endpoint == 'pages.pitchviz' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-wave-square"></i></span>
                        <span class="nav-text">PitchViz</span>
                    </a>
                    <a href="{{ url_for('workouts') }}" class="nav-item {% if request.endpoint == 'workouts' or request.endpoint == 'pages.workouts' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-dumbbell"></i></span>
                        <span class="nav-text">Workouts</span>
                    </a>
                    <a href="{{ url_for('journaling') }}" class="nav-item {% if request.endpoint == 'journaling' or request.endpoint == 'pages.journaling' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-pen-to-square"></i></span>
                        <span class="nav-text">Journaling</span>
                    </a>
                    <a href="{{ url_for('pages.matchups') }}" class="nav-item {% if request.endpoint == 'pages.matchups' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-crosshairs"></i></span>
                        <span class="nav-text">Matchups</span>
                    </a>
                    <div class="nav-divider"></div>
                    <a href="{{ url_for('pages.profile_settings') }}" class="nav-item {% if request.endpoint == 'pages.profile_settings' %}active{% endif %}">
                        <span class="nav-icon"><i class="fas fa-user-gear"></i></span>
                        <span class="nav-text">Profile Settings</span>
                    </a>
                    {% endif %}
                    <div class="nav-user-block">
                        <div class="nav-item nav-item-static">
                            <span class="nav-icon">
                                {% if current_user and current_user.profile_image_path %}
                                    <img src="{{ url_for('static', filename=current_user.profile_image_path) }}" alt="{{ current_user.first_name }} {{ current_user.last_name }}" class="nav-profile-picture">
                                {% else %}
                                    <i class="fas fa-user-circle"></i>
                                {% endif %}
                            </span>
                            <span class="nav-text nav-user-name">
                                {{ session.get('first_name', '') }} {{ session.get('last_name', '') }}
                            </span>
                        </div>
                        <form method="post" action="{{ url_for('auth.logout') }}" class="nav-item nav-logout-form">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit">
                                <span class="nav-icon"><i class="fas fa-right-from-bracket"></i></span>
                                <span class="nav-text">Logout</span>
                            </button>
                        </form>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <p class="version-text">v1.0</p>
                </div>
            </aside>
            {% if user_authenticated %}
                <!-- Sidebar Overlay for Mobile -->
                <div class="sidebar-overlay" id="sidebarOverlay"></div>
                <!-- Mobile Menu Button - Always visible on mobile -->
                <button class="mobile-menu-button" id="mobileMenuButton" aria-label="Toggle menu">
                    <img src="{{ url_for('static', filename='sequence-logo.png') }}" alt="Sequence Logo" class="mobile-menu-logo" id="mobileMenuIcon">
                </button>
            {% endif %}
        {% endif %}
        
        <!-- Main Content -->
        <main class="{% if user_authenticated %}main-content{% else %}unauthenticated-shell{% endif %}">
            {% with messages = get_flashed_messages(with_categories=True) %}
                {% if messages %}
                <div class="flash-container">
                    {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        <span class="flash-icon">
                            {% if category == 'success' %}
                                <i class="fas fa-circle-check"></i>
                            {% elif category == 'error' %}
                                <i class="fas fa-circle-exclamation"></i>
                            {% elif category == 'warning' %}
                                <i class="fas fa-triangle-exclamation"></i>
                            {% else %}
                                <i class="fas fa-circle-info"></i>
                            {% endif %}
                        </span>
                        <span class="flash-text">{{ message }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </main>
    </div>
    
    {% block scripts %}{% endblock %}
    <script>
        // Enhanced Sidebar toggle functionality with mobile support
        (function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const toggleIcon = document.getElementById('sidebarToggleIcon');
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenuIcon = document.getElementById('mobileMenuIcon');
            const mainContent = document.querySelector('.main-content');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            
            if (!sidebar) {
                return;
            }
            
            // Check if mobile
            const isMobile = () => window.innerWidth <= 1024;
            
            // Update icons based on state
            function updateIcons(collapsed, isOpen = false) {
                if (isMobile()) {
                    // Mobile: logo stays as logo, but we can add visual feedback
                    if (mobileMenuIcon && mobileMenuButton) {
                        // Add/remove active class for visual feedback
                        if (isOpen) {
                            mobileMenuButton.classList.add('sidebar-open');
                        } else {
                            mobileMenuButton.classList.remove('sidebar-open');
                        }
                    }
                    // Hide desktop toggle icon on mobile
                    if (toggleIcon) {
                        toggleIcon.style.display = 'none';
                    }
                } else {
                    // Desktop: update desktop toggle icon
                    if (toggleIcon) {
                        toggleIcon.style.display = '';
                        if (collapsed) {
                            toggleIcon.className = 'fas fa-chevron-right';
                        } else {
                            toggleIcon.className = 'fas fa-chevron-left';
                        }
                    }
                    // Hide mobile button on desktop
                    if (mobileMenuButton) {
                        mobileMenuButton.style.display = 'none';
                    }
                }
            }
            
            // Toggle sidebar function
            function toggleSidebar() {
                if (isMobile()) {
                    const isOpen = sidebar.classList.contains('open');
                    if (isOpen) {
                        sidebar.classList.remove('open');
                        if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                        document.body.style.overflow = '';
                        // Show mobile button when sidebar closes
                        if (mobileMenuButton) mobileMenuButton.style.display = 'flex';
                    } else {
                        sidebar.classList.add('open');
                        if (sidebarOverlay) sidebarOverlay.classList.add('active');
                        document.body.style.overflow = 'hidden';
                        // Hide mobile button when sidebar opens
                        if (mobileMenuButton) mobileMenuButton.style.display = 'none';
                    }
                    updateIcons(false, !isOpen);
                } else {
                    sidebar.classList.toggle('collapsed');
                    if (mainContent) {
                        mainContent.classList.toggle('sidebar-collapsed');
                    }
                    const nowCollapsed = sidebar.classList.contains('collapsed');
                    localStorage.setItem('sidebarCollapsed', nowCollapsed.toString());
                    updateIcons(nowCollapsed, false);
                }
            }
            
            // Initialize sidebar state
            function initSidebar() {
                if (isMobile()) {
                    // Mobile: start closed (hidden)
                    sidebar.classList.remove('open', 'collapsed');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                    if (mainContent) mainContent.classList.remove('sidebar-collapsed');
                    document.body.style.overflow = '';
                    // Show mobile button, hide desktop button
                    if (mobileMenuButton) mobileMenuButton.style.display = 'flex';
                    if (sidebarToggle) sidebarToggle.style.display = 'none';
                    updateIcons(false, false);
                } else {
                    // Desktop: use saved state
                    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                    sidebar.classList.remove('open');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                    // Show desktop button, hide mobile button
                    if (mobileMenuButton) mobileMenuButton.style.display = 'none';
                    if (sidebarToggle) sidebarToggle.style.display = 'flex';
                    if (isCollapsed) {
                        sidebar.classList.add('collapsed');
                        if (mainContent) {
                            mainContent.classList.add('sidebar-collapsed');
                        }
                    }
                    updateIcons(isCollapsed, false);
                }
            }
            
            // Initialize on load
            initSidebar();
            
            // Toggle sidebar - both buttons use same function
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleSidebar();
                });
            }
            
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleSidebar();
                });
            }
            
            // Close sidebar on overlay click (mobile)
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function() {
                    if (isMobile() && sidebar.classList.contains('open')) {
                        sidebar.classList.remove('open');
                        sidebarOverlay.classList.remove('active');
                        document.body.style.overflow = '';
                        // Show mobile button when sidebar closes
                        if (mobileMenuButton) mobileMenuButton.style.display = 'flex';
                        updateIcons(false, false);
                    }
                });
            }
            
            // Close sidebar on navigation click (mobile)
            function setupMobileNavClose() {
                if (isMobile()) {
                    const navItems = sidebar.querySelectorAll('.nav-item');
                    navItems.forEach(item => {
                        // Remove existing listeners by cloning
                        const newItem = item.cloneNode(true);
                        item.parentNode.replaceChild(newItem, item);
                        newItem.addEventListener('click', function() {
                            setTimeout(() => {
                                if (sidebar.classList.contains('open')) {
                                    sidebar.classList.remove('open');
                                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                                    document.body.style.overflow = '';
                                    // Show mobile button when sidebar closes
                                    if (mobileMenuButton) mobileMenuButton.style.display = 'flex';
                                    updateIcons(false, false);
                                }
                            }, 150);
                        });
                    });
                }
            }
            setupMobileNavClose();
            
            // Handle window resize
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    initSidebar();
                    setupMobileNavClose();
                }, 250);
            });
        })();

        // Auto-dismiss flash messages after 5 seconds
        (function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            if (!flashMessages.length) {
                return;
            }
            setTimeout(() => {
        flashMessages.forEach(msg => {
            msg.classList.add('flash-hidden');
            setTimeout(() => msg.remove(), 300);
        });
            }, 5000);
        })();
    </script>
</body>
</html>
