{% extends "base.html" %}

{% block title %}Home - Sequence BioLab{% endblock %}

{% block content %}
<div class="player-home">
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-background"></div>
        <div class="hero-content">
            <div class="hero-avatar-wrapper">
                {% if current_user and current_user.profile_image_path %}
                    <img src="{{ url_for('static', filename=current_user.profile_image_path) }}" alt="{{ current_user.first_name }} {{ current_user.last_name }}" class="hero-avatar-img">
                {% else %}
                    <div class="hero-avatar-placeholder">
                        <i class="fas fa-user"></i>
                    </div>
                {% endif %}
            </div>
            <div class="hero-text">
                <span class="hero-badge">{{ current_user.position or "Athlete" }}</span>
                <h1 class="hero-title">Welcome, {{ current_user.first_name or current_user.email }}</h1>
            </div>
            <div class="hero-logo">
                <img src="{{ url_for('static', filename='sequence-logo.png') }}" alt="Sequence Logo" class="hero-logo-img">
            </div>
        </div>
        {% if session.get('is_admin') and admin_user_options %}
        <div class="hero-actions">
            <form class="gameday-user-picker" method="get" action="{{ url_for('pages.home') }}" id="player-schedule-form">
                <label class="gameday-user-picker-label" for="home-user-search">View player schedule</label>
                <div class="player-search-wrapper" style="position: relative;">
                    <input 
                        type="text" 
                        id="home-user-search" 
                        class="gameday-user-search-input" 
                        placeholder="Search for a player..."
                        autocomplete="off"
                        value="{% if selected_user_id %}{% for option in admin_user_options %}{% if option.id == selected_user_id %}{{ option.label }}{% endif %}{% endfor %}{% endif %}"
                    >
                    <input type="hidden" id="home-user-id" name="user_id" value="{{ selected_user_id or '' }}">
                    <div id="home-user-dropdown" class="player-search-dropdown" style="display: none;"></div>
                </div>
            </form>
        </div>
        {% endif %}
    </section>

    <!-- Key Info Cards -->
    <section class="info-grid">
        {% if next_series %}
        <article class="info-card info-card-featured">
            <div class="info-card-top">
                <div class="info-card-icon">
                    {% if next_series.opponent_id %}
                        <span class="team-abbr-badge" style="background-color: {{ get_team_color_global(team_id=next_series.opponent_id) }}; color: white; padding: 6px 12px; border-radius: 6px; font-weight: 600; font-size: 16px; display: inline-block;">
                            {{ next_series.opponent_abbr or (next_series.opponent_id|team_abbr_from_id) or 'OPP' }}
                        </span>
                    {% else %}
                        <i class="fas fa-baseball"></i>
                    {% endif %}
                </div>
                <div class="info-card-content">
                    <span class="info-card-label">Next Opponent</span>
                    <div class="opponent-header-row">
                        <h3>{{ next_series.opponent_name }}</h3>
                    </div>
                    <p class="next-game-date">{% if next_series.start_date == next_series.end_date %}{{ next_series.start_date }}{% else %}{{ next_series.start_date }} – {{ next_series.end_date }}{% endif %}</p>
                    {% if next_series.first_game_datetime_iso %}
                    <div class="countdown-clock" id="game-countdown">
                        <div class="countdown-display">
                            <span class="countdown-label">GAME STARTS IN:</span>
                            <div class="countdown-time" id="countdown-time">
                                <span class="countdown-value" id="countdown-days">--</span>
                                <span class="countdown-unit">d</span>
                                <span class="countdown-separator">:</span>
                                <span class="countdown-value" id="countdown-hours">--</span>
                                <span class="countdown-unit">h</span>
                                <span class="countdown-separator">:</span>
                                <span class="countdown-value" id="countdown-minutes">--</span>
                                <span class="countdown-unit">m</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <a href="{{ url_for('pages.gameday') }}" class="info-card-cta">
                <span>View Gameday Prep</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </article>
        {% endif %}

        <!-- Schedule Calendar Widget with Sidebar -->
        <div class="calendar-with-sidebar">
            <article class="info-card info-card-calendar">
                <header class="panel-header">
                    <h2>Schedule</h2>
                    <a href="{{ url_for('pages.schedule') }}" class="panel-link">View full</a>
                </header>
                <div class="calendar-widget">
                    <div class="calendar-month-header" id="calendar-month-header">
                        <button class="calendar-nav-btn calendar-nav-prev" id="calendar-prev-month" aria-label="Previous month" type="button">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="calendar-month-text" id="calendar-month-text"></span>
                        <button class="calendar-nav-btn calendar-nav-next" id="calendar-next-month" aria-label="Next month" type="button">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-weekdays">
                        <div class="calendar-weekday">Sun</div>
                        <div class="calendar-weekday">Mon</div>
                        <div class="calendar-weekday">Tue</div>
                        <div class="calendar-weekday">Wed</div>
                        <div class="calendar-weekday">Thu</div>
                        <div class="calendar-weekday">Fri</div>
                        <div class="calendar-weekday">Sat</div>
                    </div>
                    <div class="calendar-days-grid" id="calendar-days-grid"></div>
                    <div class="calendar-legend">
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color calendar-legend-home"></div>
                            <span>Home</span>
                        </div>
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color calendar-legend-away"></div>
                            <span>Away</span>
                        </div>
                    </div>
                </div>
            </article>
            
            <!-- Upcoming Games Sidebar -->
            <article class="info-card info-card-upcoming">
                <header class="panel-header">
                    <h2>Upcoming Games</h2>
                </header>
                <div class="upcoming-games-list" id="upcoming-games-list">
                    <!-- Games will be populated by JavaScript -->
                </div>
            </article>
        </div>
    </section>

    <!-- Main Content Grid -->
    <section class="content-grid">
        <!-- Latest Deliverables -->
        <article class="content-panel">
            <header class="panel-header">
                <h2>Latest Reports</h2>
            </header>
            {% if deliverables %}
                <div class="deliverables-list">
                    {% for item in deliverables[:4] %}
                    <a href="{{ item.link }}" class="deliverable-item">
                        <div class="deliverable-image">
                            <div class="deliverable-image-icon">
                                <i class="{{ item.icon }}"></i>
                            </div>
                        </div>
                        <div class="deliverable-content">
                            <h4>{{ item.title }}</h4>
                            <span class="deliverable-time">{{ item.summary or item.owner }} • {{ item.time_ago }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <p>Nothing has been uploaded yet</p>
                </div>
            {% endif %}
        </article>

        <!-- News & Media -->
        <article class="content-panel content-panel-news">
            <header class="panel-header">
                <h2>News & Updates</h2>
            </header>
            {% if player_news %}
            <div class="news-list">
                {% for news in player_news %}
                <a href="{{ news.link }}" target="_blank" rel="noopener noreferrer" class="news-item" onclick="window.open(this.href, '_blank', 'noopener,noreferrer'); return false;">
                    <div class="news-image">
                        {% if news.image %}
                            <img src="{{ news.image }}" alt="{{ news.title }}" class="news-image-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        {% endif %}
                        <div class="news-image-fallback" {% if news.image %}style="display: none;"{% endif %}>
                            <div class="news-image-fallback-icon">
                                <i class="fas fa-baseball-ball"></i>
                            </div>
                        </div>
                    </div>
                    <div class="news-content">
                        <h4>{{ news.title }}</h4>
                        <span class="news-time">{{ news.time_ago }}</span>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-newspaper"></i>
                <p>No recent news available</p>
            </div>
            {% endif %}
        </article>

    </section>
</div>

<!-- Footer -->
<footer class="home-footer">
    <div class="home-footer-content">
        <a href="https://www.instagram.com/sequencebiolab/" target="_blank" rel="noopener noreferrer" class="home-footer-link">
            <i class="fab fa-instagram"></i>
            <span>@sequencebiolab</span>
        </a>
        <span class="home-footer-separator">•</span>
        <a href="{{ url_for('pages.contact_us') }}" class="home-footer-link">Contact Us</a>
        <span class="home-footer-separator">•</span>
        <a href="{{ url_for('pages.terms_of_service') }}" class="home-footer-link">Terms of Service</a>
        <span class="home-footer-separator">•</span>
        <a href="{{ url_for('pages.privacy_policy') }}" class="home-footer-link">Privacy Policy</a>
    </div>
</footer>
{% endblock %}

{% block scripts %}
<style>
.player-home {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 32px 64px;
    display: grid;
    gap: 40px;
}

/* Hero Section */
.hero-section {
    position: relative;
    border-radius: 32px;
    overflow-x: hidden;
    overflow-y: visible;
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.12), rgba(255, 149, 0, 0.06));
    border: 1px solid rgba(255, 127, 0, 0.2);
    padding: 48px 40px;
    margin-top: 24px;
}

.hero-background {
    position: absolute;
    inset: 0;
    background: 
        radial-gradient(circle at 20% 50%, rgba(255, 127, 0, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(255, 149, 0, 0.06) 0%, transparent 50%);
    pointer-events: none;
}

.hero-content {
    position: relative;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 32px;
    z-index: 1;
}

.hero-avatar-wrapper {
    width: 100px;
    height: 100px;
    border-radius: 24px;
    overflow: hidden;
    border: 3px solid rgba(255, 127, 0, 0.3);
    box-shadow: 0 8px 32px rgba(255, 127, 0, 0.2);
    background: var(--color-layer-soft);
}

.hero-avatar-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.hero-avatar-placeholder {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    font-size: 2.5rem;
    color: var(--color-accent);
}

.hero-text {
    display: grid;
    gap: 8px;
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 16px;
    border-radius: 999px;
    background: rgba(255, 127, 0, 0.15);
    color: var(--color-accent);
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    width: fit-content;
    border: 1px solid rgba(255, 127, 0, 0.3);
}

.hero-title {
    margin: 0;
    font-size: clamp(2rem, 4vw, 2.75rem);
    font-weight: 800;
    color: var(--color-text-primary);
    line-height: 1.1;
    letter-spacing: -0.02em;
}


.hero-subtitle {
    margin: 0;
    font-size: 1.1rem;
    color: var(--color-text-secondary);
    font-weight: 500;
}

.hero-action {
    display: flex;
    align-items: center;
}

.hero-cta {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 16px 32px;
    border-radius: 16px;
    background: linear-gradient(135deg, var(--color-accent), var(--color-accent-bright));
    color: var(--color-text-inverse);
    font-weight: 700;
    font-size: 1rem;
    text-decoration: none;
    box-shadow: 0 8px 24px rgba(255, 127, 0, 0.35);
    transition: all 0.3s ease;
    border: none;
}

.hero-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(255, 127, 0, 0.45);
}

.hero-cta i {
    transition: transform 0.3s ease;
}

.hero-cta:hover i {
    transform: translateX(4px);
}

.hero-skeleton {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.4;
    transition: opacity 0.3s ease;
}

.hero-skeleton:hover {
    opacity: 0.6;
}

.hero-skeleton-svg {
    width: 120px;
    height: 120px;
    filter: drop-shadow(0 0 8px rgba(255, 127, 0, 0.3));
}

.hero-logo {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    opacity: 0.9;
    transition: opacity 0.3s ease;
}

.hero-logo:hover {
    opacity: 1;
}

.hero-logo-img {
    max-width: 300px;
    max-height: 120px;
    width: auto;
    height: auto;
    object-fit: contain;
}

.hero-actions {
    position: relative;
    z-index: 1;
    margin-top: 24px;
    display: flex;
    justify-content: flex-start;
    overflow: visible;
}

.player-search-wrapper {
    position: relative;
    width: 100%;
    min-width: 250px;
    max-width: 350px;
    z-index: 99998;
}

.gameday-user-search-input {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--color-layer-border);
    border-radius: 8px;
    background: var(--color-layer-card);
    color: var(--color-text-primary);
    font-size: 0.95rem;
    font-weight: 500;
    transition: all 0.2s ease;
    min-height: 44px;
    box-sizing: border-box;
}

.gameday-user-search-input:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(255, 127, 0, 0.1);
}

.player-search-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--color-layer-card);
    border: 1px solid var(--color-layer-border);
    border-top: none;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 99999;
    margin-top: 2px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.player-search-dropdown-item {
    padding: 12px 14px;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: background 0.2s ease;
    border-bottom: 1px solid var(--color-layer-border);
    font-size: 0.95rem;
}

.player-search-dropdown-item:hover {
    background: rgba(255, 127, 0, 0.1);
    color: var(--color-accent);
}

.player-search-dropdown-item:last-child {
    border-bottom: none;
}

.player-search-dropdown-item.selected {
    background: rgba(255, 127, 0, 0.15);
    color: var(--color-accent);
    font-weight: 600;
}

.hero-section .gameday-user-picker {
    background: var(--color-layer);
    border: 1px solid var(--color-layer-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 99997;
    overflow: visible;
}

.hero-section .gameday-user-picker .custom-select-wrapper {
    min-width: 250px;
    max-width: 350px;
    position: relative !important;
    display: block !important;
    width: 100% !important;
    z-index: 10000 !important;
    overflow: visible !important;
}

.hero-section .gameday-user-picker .custom-select {
    width: 100% !important;
    min-width: 250px !important;
    max-width: 350px !important;
    padding: 8px 12px !important;
    background: var(--color-layer-input) !important;
    border: 1px solid var(--color-layer-border) !important;
    border-radius: 8px !important;
    color: var(--color-text-primary) !important;
    font-size: 0.95rem !important;
    font-weight: 500 !important;
    min-height: 44px !important;
}

.hero-section .gameday-user-picker .custom-select:hover {
    border-color: rgba(255, 127, 0, 0.3) !important;
}

.hero-section .gameday-user-picker .custom-select.open {
    border-color: var(--color-accent) !important;
    border-radius: 8px 8px 0 0 !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: 0 !important;
    min-width: 250px !important;
    max-width: 350px !important;
    width: 100% !important;
    max-height: 300px !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    z-index: 10001 !important;
    background: var(--color-layer) !important;
    border: 1px solid var(--color-layer-border) !important;
    border-top: none !important;
    border-radius: 0 0 8px 8px !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    display: none !important;
    overscroll-behavior: contain !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown.open {
    display: block !important;
}

.hero-section .gameday-user-picker .custom-select-option {
    white-space: nowrap !important;
    overflow: visible !important;
    text-overflow: ellipsis !important;
    padding: 10px 12px !important;
    min-height: 44px !important;
    display: flex !important;
    align-items: center !important;
    width: 100% !important;
    box-sizing: border-box !important;
    flex-shrink: 0 !important;
}

/* Ensure scrollbar is visible and always shows when content overflows */
.hero-section .gameday-user-picker .custom-select-dropdown {
    scrollbar-width: thin !important;
    scrollbar-color: var(--color-text-subtle) var(--color-layer-soft) !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown::-webkit-scrollbar {
    width: 8px !important;
    display: block !important;
    -webkit-appearance: none !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown::-webkit-scrollbar-track {
    background: var(--color-layer-soft) !important;
    border-radius: 4px !important;
    -webkit-box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.1) !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown::-webkit-scrollbar-thumb {
    background: var(--color-text-subtle) !important;
    border-radius: 4px !important;
    min-height: 20px !important;
    -webkit-box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.2) !important;
}

.hero-section .gameday-user-picker .custom-select-dropdown::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-secondary) !important;
}

/* Info Grid */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
}

.info-card {
    background: var(--color-layer);
    border: 1px solid var(--color-layer-border);
    border-radius: 24px;
    padding: 28px;
    display: flex;
    gap: 20px;
    align-items: flex-start;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.info-card-calendar,
.info-card-upcoming {
    overflow: visible;
}

.info-card:has(.info-card-cta) {
    flex-direction: column;
    gap: 20px;
}

.info-card-featured {
    flex-direction: column;
    gap: 20px;
    grid-column: 1 / -1;
}

.info-card::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.05), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 0;
}

.info-card:hover {
    border-color: rgba(255, 127, 0, 0.4);
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
}

.info-card:hover::before {
    opacity: 1;
}

.info-card-featured {
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.08), rgba(255, 149, 0, 0.04));
    border-color: rgba(255, 127, 0, 0.3);
    flex-direction: column;
    gap: 20px;
}

.info-card-top {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    width: 100%;
}

.info-card-featured .info-card-content {
    flex: 1;
}

.info-card-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.2), rgba(255, 149, 0, 0.1));
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-accent);
    font-size: 1.5rem;
    flex-shrink: 0;
    border: 1px solid rgba(255, 127, 0, 0.2);
    padding: 8px;
}

.info-card-logo {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.info-card-content {
    flex: 1;
    display: grid;
    gap: 8px;
    position: relative;
    z-index: 1;
}

.info-card-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-subtle);
}

.opponent-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
}

.info-card-content h3 {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--color-text-primary);
    line-height: 1.2;
    flex: 1;
    min-width: 0;
}

.next-game-date {
    margin: 8px 0 12px 0;
    font-size: 0.95rem;
    color: var(--color-text-secondary);
    font-weight: 500;
}

.info-card-content p {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: 0.95rem;
}

/* Countdown Clock */
.countdown-clock {
    flex-shrink: 0;
}

.countdown-display {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.countdown-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-subtle);
    white-space: nowrap;
}

.countdown-time {
    display: flex;
    align-items: baseline;
    gap: 4px;
    font-weight: 700;
    white-space: nowrap;
}

.countdown-value {
    font-size: 1.5rem;
    color: var(--color-accent);
    line-height: 1;
    min-width: 28px;
    text-align: center;
    font-weight: 700;
}

.countdown-unit {
    font-size: 0.85rem;
    color: var(--color-text-subtle);
    font-weight: 600;
    margin-left: 2px;
}

.countdown-separator {
    font-size: 1.2rem;
    color: var(--color-text-tertiary);
    margin: 0 2px;
    font-weight: 400;
}

.info-card-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: 999px;
    background: rgba(255, 127, 0, 0.15);
    color: var(--color-accent);
    font-size: 0.8rem;
    font-weight: 600;
    width: fit-content;
    margin-top: 4px;
}

.info-card-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--color-accent);
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    margin-top: 4px;
    transition: gap 0.3s ease;
}

.info-card-link:hover {
    gap: 10px;
}

.info-card-link i {
    font-size: 0.75rem;
    transition: transform 0.3s ease;
}

.info-card-link:hover i {
    transform: translateX(4px);
}

.info-card-cta {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 14px 24px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--color-accent), var(--color-accent-bright));
    color: var(--color-text-inverse);
    font-weight: 700;
    font-size: 0.95rem;
    text-decoration: none;
    box-shadow: 0 6px 20px rgba(255, 127, 0, 0.35);
    transition: all 0.3s ease;
    width: fit-content;
    margin-top: 8px;
    cursor: pointer;
    position: relative;
    z-index: 10;
    pointer-events: auto;
    -webkit-tap-highlight-color: rgba(255, 127, 0, 0.3);
}

.info-card-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(255, 127, 0, 0.45);
}

.info-card-cta i {
    font-size: 0.9rem;
    transition: transform 0.3s ease;
    pointer-events: none;
}

.info-card-cta:hover i {
    transform: translateX(4px);
}

/* Content Grid */
.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 32px;
}

.content-panel {
    background: var(--color-layer);
    border: 1px solid var(--color-layer-border);
    border-radius: 24px;
    padding: 32px;
    display: grid;
    gap: 24px;
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
}

.panel-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
}

.panel-link {
    color: var(--color-text-subtle);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    transition: color 0.3s ease;
    cursor: pointer;
    position: relative;
    z-index: 10;
}

.panel-link:hover {
    color: var(--color-accent);
}

/* Deliverables */
.deliverables-list {
    display: grid;
    gap: 20px;
}

.deliverable-item {
    display: flex;
    gap: 16px;
    padding: 16px;
    border-radius: 16px;
    background: var(--color-layer-soft);
    border: 1px solid var(--color-layer-border);
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    align-items: center;
    height: 112px;
    box-sizing: border-box;
}

.deliverable-item:hover {
    border-color: var(--color-layer-border);
    transform: translateX(4px);
    background: var(--color-layer-soft);
}

.deliverable-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    background: var(--color-layer);
    display: grid;
    place-items: center;
    overflow: hidden;
    flex-shrink: 0;
    border: 1px solid var(--color-layer-border);
}

.deliverable-image-icon {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.2), rgba(255, 149, 0, 0.1));
    color: var(--color-accent);
    font-size: 2rem;
    opacity: 0.8;
}

.deliverable-content {
    flex: 1;
    display: grid;
    gap: 8px;
    min-width: 0;
    overflow: hidden;
}

.deliverable-content h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.deliverable-time {
    font-size: 0.85rem;
    color: var(--color-text-subtle);
}

/* News Section */
.content-panel-news {
    background: var(--color-layer);
}

.news-list {
    display: grid;
    gap: 20px;
}

.news-item {
    display: flex;
    gap: 16px;
    padding: 16px;
    border-radius: 16px;
    background: var(--color-layer-soft);
    border: 1px solid var(--color-layer-border);
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    align-items: center;
    height: 112px;
    box-sizing: border-box;
}

.news-item:hover {
    border-color: var(--color-layer-border);
    transform: translateX(4px);
    background: var(--color-layer-soft);
}

.news-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    background: var(--color-layer);
    display: grid;
    place-items: center;
    overflow: hidden;
    flex-shrink: 0;
    border: 1px solid var(--color-layer-border);
}

.news-image-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.news-image-fallback {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(255, 127, 0, 0.2), rgba(255, 149, 0, 0.1));
    overflow: hidden;
    position: relative;
}

.news-image-fallback-img {
    width: 100%;
    height: 120%;
    object-fit: cover;
    object-position: center center;
    transform: translateY(-2%);
}

.news-image-fallback-logo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    transform: none;
}

.news-image-fallback-icon {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    font-size: 2rem;
    color: var(--color-accent);
    opacity: 0.8;
}

.news-content {
    flex: 1;
    display: grid;
    gap: 8px;
    min-width: 0;
    overflow: hidden;
}

.news-content h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.news-time {
    font-size: 0.85rem;
    color: var(--color-text-subtle);
}

/* Calendar Widget with Sidebar */
.calendar-with-sidebar {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 24px;
    align-items: start;
}

.info-card-calendar {
    width: 100%;
    display: flex;
    flex-direction: column;
}

.info-card-calendar:hover {
    border-color: var(--color-layer-border);
    transform: none;
    box-shadow: none;
}

.info-card-calendar:hover::before {
    opacity: 0;
}

.info-card-calendar .panel-header,
.info-card-upcoming .panel-header,
.content-panel .panel-header {
    border-bottom: 2px solid var(--color-accent);
    padding-bottom: 12px;
    margin-bottom: 0;
    width: 100%;
}

.calendar-widget {
    margin-top: 20px;
    width: 100%;
    display: flex;
    flex-direction: column;
}

.calendar-month-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 16px;
}

.calendar-month-text {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-align: center;
    flex: 1;
}

.calendar-nav-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--color-layer-border);
    border-radius: 8px;
    background: var(--color-layer-soft);
    color: var(--color-text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    flex-shrink: 0;
    position: relative;
    z-index: 10;
    pointer-events: auto;
    -webkit-tap-highlight-color: rgba(255, 127, 0, 0.3);
}

.calendar-nav-btn:hover {
    background: var(--color-layer);
    border-color: var(--color-accent);
    color: var(--color-accent);
    transform: translateY(-1px);
}

.calendar-nav-btn:active {
    transform: translateY(0);
}

.calendar-nav-btn i {
    font-size: 0.85rem;
    pointer-events: none;
}


.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-bottom: 8px;
}

.calendar-weekday {
    text-align: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-text-subtle);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 8px 4px;
}

.calendar-days-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 4px;
    border-radius: 8px;
    background: var(--color-layer-soft);
    border: 1px solid var(--color-layer-border);
    position: relative;
    transition: all 0.2s ease;
    min-height: 48px;
    overflow: visible;
    box-sizing: border-box;
}

.calendar-day.other-month {
    opacity: 0.3;
}

.calendar-day.today {
    background: rgba(255, 127, 0, 0.2);
    border: 2px solid var(--color-accent);
    border-color: var(--color-accent);
    font-weight: 700;
    box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.3), 0 2px 8px rgba(255, 127, 0, 0.4);
    position: relative;
}

.calendar-day.today::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border: 2px solid var(--color-accent);
    border-radius: 8px;
    opacity: 0.5;
    pointer-events: none;
}

.calendar-day.today .calendar-day-number {
    font-weight: 800;
    font-size: 0.85rem;
    color: var(--color-accent);
}

.calendar-day.has-game {
    cursor: pointer;
}

.calendar-day.has-game:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.calendar-day.has-game.game-home {
    background: rgba(255, 127, 0, 0.15);
    border-color: rgba(255, 127, 0, 0.4);
}

.calendar-day.has-game.game-away {
    background: rgba(100, 150, 255, 0.15);
    border-color: rgba(100, 150, 255, 0.4);
}

.calendar-day.has-game.today.game-home {
    background: rgba(255, 127, 0, 0.3);
    border: 2px solid var(--color-accent);
    box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.4), 0 2px 8px rgba(255, 127, 0, 0.5);
}

.calendar-day.has-game.today.game-away {
    background: rgba(100, 150, 255, 0.3);
    border: 2px solid var(--color-accent);
    box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.4), 0 2px 8px rgba(255, 127, 0, 0.5);
}

.calendar-day-number {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
    z-index: 1;
    align-self: flex-start;
    width: 100%;
    text-align: left;
    padding-left: 2px;
    line-height: 1;
}

.calendar-team-logo {
    width: 44px;
    height: 44px;
    max-width: 44px;
    max-height: 44px;
    object-fit: contain;
    z-index: 2;
    opacity: 1;
    display: block;
    align-self: center;
    margin-top: auto;
    flex-shrink: 0;
    flex-grow: 0;
}

.calendar-game-indicator {
    position: absolute;
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.65rem;
    color: var(--color-accent);
    z-index: 1;
}

.calendar-legend {
    display: flex;
    gap: 20px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--color-layer-border);
    justify-content: center;
}

.calendar-legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--color-text-subtle);
}

.calendar-legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 1px solid;
}

.calendar-legend-home {
    background: rgba(255, 127, 0, 0.15);
    border-color: rgba(255, 127, 0, 0.4);
}

.calendar-legend-away {
    background: rgba(100, 150, 255, 0.15);
    border-color: rgba(100, 150, 255, 0.4);
}

/* Empty State */
.empty-state {
    padding: 48px 24px;
    text-align: center;
    color: var(--color-text-muted);
}

.empty-state i {
    font-size: 3rem;
    color: var(--color-text-subtle);
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state p {
    margin: 0;
    font-size: 0.95rem;
}

/* Upcoming Games Sidebar */
.info-card-upcoming {
    width: 100%;
    height: fit-content;
    display: grid;
    gap: 24px;
    padding: 32px;
    position: sticky;
    top: 24px;
    max-height: none;
}

.info-card-upcoming:hover {
    border-color: var(--color-layer-border);
    transform: none;
    box-shadow: none;
}

.info-card-upcoming:hover::before {
    opacity: 0;
}

.upcoming-games-list {
    display: grid;
    gap: 20px;
    overflow-y: auto;
    max-height: none;
    padding-bottom: 0;
}

.upcoming-game-item {
    display: flex;
    gap: 16px;
    padding: 16px;
    border-radius: 16px;
    background: var(--color-layer-soft);
    border: 1px solid var(--color-layer-border);
    transition: all 0.3s ease;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
    height: 112px;
    box-sizing: border-box;
    align-items: center;
    flex-shrink: 0;
}

.upcoming-game-item:hover {
    border-color: var(--color-layer-border);
    transform: translateX(4px);
    background: var(--color-layer-soft);
}

.upcoming-game-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    padding: 8px;
    border-radius: 12px;
    background: var(--color-layer);
    border: 1px solid var(--color-layer-border);
    flex-shrink: 0;
}

.upcoming-game-day {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--color-text-subtle);
    letter-spacing: 0.05em;
}

.upcoming-game-number {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--color-text-primary);
    line-height: 1;
    margin-top: 4px;
}

.upcoming-game-details {
    flex: 1;
    display: grid;
    gap: 8px;
    min-width: 0;
    overflow: hidden;
}

.upcoming-game-matchup {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.upcoming-game-vs {
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}

.upcoming-game-vs.home {
    background: rgba(255, 127, 0, 0.2);
    color: var(--color-accent);
}

.upcoming-game-vs.away {
    background: rgba(100, 150, 255, 0.2);
    color: rgba(100, 150, 255, 1);
}

.upcoming-game-opponent {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-primary);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.3;
}

.upcoming-game-venue {
    font-size: 0.85rem;
    color: var(--color-text-subtle);
    display: flex;
    align-items: center;
    gap: 6px;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.4;
}

.upcoming-game-venue i {
    font-size: 0.75rem;
}

.upcoming-game-empty {
    padding: 32px 16px;
    text-align: center;
    color: var(--color-text-muted);
    font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 1024px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .calendar-with-sidebar {
        grid-template-columns: 1fr;
    }
    
    .info-card-upcoming {
        position: static;
    }

    .calendar-team-logo {
        width: 36px;
        height: 36px;
        max-width: 36px;
        max-height: 36px;
    }
}

@media (max-width: 768px) {
    .player-home {
        padding: 0 20px 48px;
        gap: 32px;
    }

    .hero-section {
        padding: 32px 24px;
        border-radius: 24px;
    }

    .hero-content {
        grid-template-columns: 1fr;
        gap: 24px;
        text-align: center;
    }

    .hero-avatar-wrapper {
        margin: 0 auto;
    }

    .hero-text {
        align-items: center;
        text-align: center;
    }

    .hero-badge {
        margin: 0 auto;
    }

    .opponent-header-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }

    .countdown-display {
        width: 100%;
    }

    .hero-action {
        justify-content: center;
    }

    .hero-cta {
        width: 100%;
        justify-content: center;
    }

    .hero-skeleton {
        display: none;
    }

    .hero-logo {
        display: none;
    }

    .info-grid {
        grid-template-columns: 1fr;
    }

    .content-panel {
        padding: 24px;
    }

    .info-card-cta {
        width: 100%;
        justify-content: center;
        min-height: 48px;
        -webkit-tap-highlight-color: rgba(255, 127, 0, 0.3);
    }

    .calendar-days-grid {
        gap: 6px;
    }

    .calendar-day {
        min-height: 52px;
        padding: 5px;
        overflow: visible;
    }

    .calendar-team-logo {
        width: 28px;
        height: 28px;
        max-width: 28px;
        max-height: 28px;
    }

    .calendar-day-number {
        font-size: 0.7rem;
        padding-left: 3px;
    }
}

@media (max-width: 480px) {
    .player-home {
        padding: 0 16px 32px;
    }

    .hero-section {
        padding: 24px 20px;
    }

    .hero-title {
        font-size: 1.75rem;
    }

    .content-panel {
        padding: 20px;
    }

    .info-card-cta {
        padding: 16px 20px;
        font-size: 0.9rem;
        min-height: 48px;
    }

    .calendar-days-grid {
        gap: 4px;
    }

    .calendar-day {
        min-height: 50px;
        padding: 4px;
    }

    .calendar-team-logo {
        width: 24px;
        height: 24px;
        max-width: 24px;
        max-height: 24px;
    }

    .calendar-day-number {
        font-size: 0.65rem;
    }

    .calendar-weekday {
        font-size: 0.7rem;
        padding: 6px 2px;
    }
}

/* Home Footer Styles */
.home-footer {
    max-width: 1400px;
    margin: 60px auto 0;
    padding: 32px;
    border-top: 1px solid var(--color-layer-border);
}

.home-footer-content {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 12px 16px;
    color: var(--color-text-subtle);
    font-size: 0.875rem;
    line-height: 1.5;
}

.home-footer-link {
    color: var(--color-text-subtle);
    text-decoration: none;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 500;
}

.home-footer-link:hover {
    color: var(--color-accent);
    background: var(--color-accent-soft);
    transform: translateY(-1px);
}

.home-footer-link i {
    font-size: 0.9rem;
}

.home-footer-separator {
    color: var(--color-text-tertiary);
    user-select: none;
}

/* Responsive Footer */
@media (max-width: 768px) {
    .home-footer {
        margin-top: 40px;
        padding: 24px 20px;
    }
    
    .home-footer-content {
        font-size: 0.8125rem;
        gap: 10px 12px;
    }
    
    .home-footer-link {
        padding: 6px 10px;
    }
}

@media (max-width: 480px) {
    .home-footer {
        padding: 20px 16px;
    }
    
    .home-footer-content {
        font-size: 0.75rem;
        gap: 8px;
        flex-direction: column;
    }
    
    .home-footer-separator {
        display: none;
    }
    
    .home-footer-link {
        padding: 8px 12px;
        width: 100%;
        justify-content: center;
    }
}
</style>
<script>
// Calendar widget initialization
(function() {
    // Team abbreviation to MLB team ID mapping
    const TEAM_ABBR_TO_ID = {
        "ARI": 109, "ATL": 144, "BAL": 110, "BOS": 111, "CHC": 112, "CWS": 145, "CIN": 113,
        "CLE": 114, "COL": 115, "DET": 116, "HOU": 117, "KC": 118, "LAA": 108, "LAD": 119,
        "MIA": 146, "MIL": 158, "MIN": 142, "NYM": 121, "NYY": 147, "OAK": 133, "PHI": 143,
        "PIT": 134, "SD": 135, "SF": 137, "SEA": 136, "STL": 138, "TB": 139, "TEX": 140,
        "TOR": 141, "WSH": 120, "WSN": 120, "WAS": 120
    };
    
    const TEAM_COLORS = {
        109: "#A71930", 144: "#CE1141", 110: "#DF4601", 111: "#BD3039",
        112: "#0E3386", 145: "#27251F", 113: "#C6011F", 114: "#E31937",
        115: "#33006F", 116: "#0C2340", 117: "#002D62", 118: "#004687",
        108: "#BA0021", 119: "#005A9C", 146: "#00A3E0", 158: "#0A2351",
        142: "#002B5C", 121: "#002D72", 147: "#132448", 133: "#003831",
        143: "#E81828", 134: "#FDB827", 135: "#2F241D", 137: "#FD5A1E",
        136: "#0C2C56", 138: "#C41E3A", 139: "#092C5C", 140: "#003278",
        141: "#134A8E", 120: "#AB0003"
    };
    
    const TEAM_ID_TO_ABBR = {
        109: "ARI", 144: "ATL", 110: "BAL", 111: "BOS", 112: "CHC", 145: "CWS", 113: "CIN",
        114: "CLE", 115: "COL", 116: "DET", 117: "HOU", 118: "KC", 108: "LAA", 119: "LAD",
        146: "MIA", 158: "MIL", 142: "MIN", 121: "NYM", 147: "NYY", 133: "OAK", 143: "PHI",
        134: "PIT", 135: "SD", 137: "SF", 136: "SEA", 138: "STL", 139: "TB", 140: "TEX",
        141: "TOR", 120: "WSH"
    };
    
    function getTeamColor(teamId) {
        return TEAM_COLORS[teamId] || '#666666';
    }
    
    function getTeamAbbrFromId(teamId) {
        return TEAM_ID_TO_ABBR[teamId] || 'OPP';
    }
    
    // Use real schedule data from backend
    const scheduleCalendar = {{ (schedule_calendar or [])|tojson|safe }};
    
    console.log('Schedule calendar data received:', scheduleCalendar);
    console.log('Number of games:', scheduleCalendar.length);
    
    // Create a map of dates to games
    const gamesByDate = {};
    scheduleCalendar.forEach(game => {
        if (game && game.date) {
            gamesByDate[game.date] = game;
            console.log('Added game to map:', game.date, game.opponent, game.opponent_id, game.opponent_abbr);
        }
    });
    
    console.log('Games by date map:', gamesByDate);
    
    // Get current month based on today's date
    const today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();
    const currentDate = today.getDate();
    
    // Month names
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                       'July', 'August', 'September', 'October', 'November', 'December'];
    
    // Calendar rendering function
    function renderCalendar(month, year) {
        // Update month header text
        const monthText = document.getElementById('calendar-month-text');
        if (monthText) {
            monthText.textContent = `${monthNames[month]} ${year}`;
        }
        
        // Get first day of month and number of days
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        // Render calendar
        const container = document.getElementById('calendar-days-grid');
        if (!container) return;
        
        container.innerHTML = '';
        
        // Add empty cells for days before month starts
        for (let i = 0; i < startingDayOfWeek; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'calendar-day other-month';
            container.appendChild(emptyDiv);
        }
        
        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            // Format date as YYYY-MM-DD to match game dates
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const game = gamesByDate[dateStr];
            const isToday = day === currentDate && month === today.getMonth() && year === today.getFullYear();
            
            // Debug: log game matching
            if (game) {
                console.log('Found game for date:', dateStr, game);
            }
            
            // Debug: log if game found but no logo
            if (game && !game.opponent_id && !game.opponent_abbr) {
                console.warn('Game found but missing team ID/abbr:', dateStr, game);
            }
            
            const dayDiv = document.createElement('div');
            let classes = 'calendar-day';
            if (isToday) classes += ' today';
            if (game) {
                classes += ' has-game';
                if (game.is_home) {
                    classes += ' game-home';
                } else {
                    classes += ' game-away';
                }
            }
            
            dayDiv.className = classes;
            
            // Make clickable if there's a game
            if (game) {
                dayDiv.style.cursor = 'pointer';
                dayDiv.addEventListener('click', function() {
                    window.location.href = `{{ url_for('pages.gameday') }}?date=${dateStr}`;
                });
            }
            
            // Get team ID for badge
            let logoHtml = '';
            if (game) {
                const teamId = game.opponent_id || (game.opponent_abbr && TEAM_ABBR_TO_ID[game.opponent_abbr.toUpperCase()]);
                const teamAbbr = game.opponent_abbr || (teamId && getTeamAbbrFromId(teamId)) || 'OPP';
                const teamColor = teamId ? getTeamColor(teamId) : '#666666';
                if (teamId || teamAbbr) {
                    logoHtml = `<span class="calendar-team-badge" style="background-color: ${teamColor}; color: white; padding: 2px 6px; border-radius: 4px; font-weight: 600; font-size: 11px; display: inline-block; min-width: 32px; text-align: center;" title="${game.is_home ? 'vs' : '@'} ${game.opponent}">${teamAbbr}</span>`;
                } else {
                    logoHtml = `<div class="calendar-game-indicator" title="${game.is_home ? 'vs' : '@'} ${game.opponent}"><i class="fas fa-baseball"></i></div>`;
                }
            }
            
            dayDiv.innerHTML = `
                <div class="calendar-day-number">${day}</div>
                ${logoHtml}
            `;
            
            container.appendChild(dayDiv);
        }
        
        // Fill remaining cells to complete the grid (next month's days)
        const totalCells = startingDayOfWeek + daysInMonth;
        const remainingCells = 7 - (totalCells % 7);
        if (remainingCells < 7) {
            for (let i = 0; i < remainingCells; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'calendar-day other-month';
                container.appendChild(emptyDiv);
            }
        }
    }
    
    // Initial calendar render
    renderCalendar(currentMonth, currentYear);
    
    // Month navigation event listeners
    const prevBtn = document.getElementById('calendar-prev-month');
    const nextBtn = document.getElementById('calendar-next-month');
    
    if (prevBtn) {
        prevBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentMonth, currentYear);
        });
    }
    
    if (nextBtn) {
        nextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentMonth, currentYear);
        });
    }
    
    // Populate upcoming games sidebar
    const upcomingGamesList = document.getElementById('upcoming-games-list');
    if (upcomingGamesList && scheduleCalendar && scheduleCalendar.length > 0) {
        // Get today's date
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Filter and sort upcoming games (up to 365 days ahead)
        const upcomingGames = scheduleCalendar
            .filter(game => {
                if (!game || !game.date) return false;
                const gameDate = new Date(game.date + 'T00:00:00');
                gameDate.setHours(0, 0, 0, 0);
                return gameDate >= today;
            })
            .sort((a, b) => {
                const dateA = new Date(a.date + 'T00:00:00');
                const dateB = new Date(b.date + 'T00:00:00');
                return dateA - dateB;
            })
            .slice(0, 4); // Show next 4 games
        
        if (upcomingGames.length === 0) {
            upcomingGamesList.innerHTML = '<div class="upcoming-game-empty">No upcoming games scheduled</div>';
        } else {
            upcomingGamesList.innerHTML = '';
            
            upcomingGames.forEach(game => {
                const gameDate = new Date(game.date + 'T00:00:00');
                const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
                const dayName = dayNames[gameDate.getDay()];
                const dayNumber = gameDate.getDate();
                
                const gameItem = document.createElement('a');
                gameItem.className = 'upcoming-game-item';
                gameItem.href = `{{ url_for('pages.gameday') }}?date=${game.date}`;
                
                const vsClass = game.is_home ? 'home' : 'away';
                const vsText = game.is_home ? 'VS' : '@';
                const opponent = game.opponent || game.opponent_name || 'TBD';
                const venue = game.venue || 'TBD';
                
                // Create date container
                const dateContainer = document.createElement('div');
                dateContainer.className = 'upcoming-game-date';
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'upcoming-game-day';
                dayDiv.textContent = dayName;
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'upcoming-game-number';
                numberDiv.textContent = dayNumber;
                
                dateContainer.appendChild(dayDiv);
                dateContainer.appendChild(numberDiv);
                
                // Create details container
                const detailsContainer = document.createElement('div');
                detailsContainer.className = 'upcoming-game-details';
                
                // Create matchup
                const matchupDiv = document.createElement('div');
                matchupDiv.className = 'upcoming-game-matchup';
                
                const vsSpan = document.createElement('span');
                vsSpan.className = `upcoming-game-vs ${vsClass}`;
                vsSpan.textContent = vsText;
                
                const opponentSpan = document.createElement('span');
                opponentSpan.className = 'upcoming-game-opponent';
                opponentSpan.textContent = opponent;
                
                matchupDiv.appendChild(vsSpan);
                matchupDiv.appendChild(opponentSpan);
                
                // Create venue
                const venueDiv = document.createElement('div');
                venueDiv.className = 'upcoming-game-venue';
                
                const venueIcon = document.createElement('i');
                venueIcon.className = 'fas fa-location-dot';
                venueDiv.appendChild(venueIcon);
                
                const venueText = document.createTextNode(` ${venue}`);
                venueDiv.appendChild(venueText);
                
                detailsContainer.appendChild(matchupDiv);
                detailsContainer.appendChild(venueDiv);
                
                gameItem.appendChild(dateContainer);
                gameItem.appendChild(detailsContainer);
                
                upcomingGamesList.appendChild(gameItem);
            });
        }
    } else if (upcomingGamesList) {
        upcomingGamesList.innerHTML = '<div class="upcoming-game-empty">No upcoming games scheduled</div>';
    }
})();

// Handle player schedule search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('home-user-search');
    const hiddenInput = document.getElementById('home-user-id');
    const dropdown = document.getElementById('home-user-dropdown');
    const playerForm = document.getElementById('player-schedule-form');
    
    if (!searchInput || !hiddenInput || !dropdown || !playerForm) {
        return;
    }
    
    // Get user options from the page (we'll need to pass them from backend)
    const userOptions = [
        {% for option in admin_user_options %}
        {id: {{ option.id }}, label: "{{ option.label|e }}"}{% if not loop.last %},{% endif %}
        {% endfor %}
    ];
    
    let selectedUserId = {{ selected_user_id or 'null' }};
    let filteredOptions = [];
    
    function filterOptions(query) {
        if (!query || query.trim() === '') {
            return userOptions;
        }
        const lowerQuery = query.toLowerCase();
        return userOptions.filter(option => 
            option.label.toLowerCase().includes(lowerQuery)
        );
    }
    
    function renderDropdown(options) {
        if (options.length === 0) {
            dropdown.innerHTML = '<div class="player-search-dropdown-item">No players found</div>';
            dropdown.style.display = 'block';
            return;
        }
        
        dropdown.innerHTML = options.map(option => {
            const isSelected = option.id === selectedUserId;
            return `<div class="player-search-dropdown-item ${isSelected ? 'selected' : ''}" 
                        data-id="${option.id}" 
                        data-label="${option.label}">
                    ${option.label}
                </div>`;
        }).join('');
        
        dropdown.style.display = 'block';
        
        // Add click handlers
        dropdown.querySelectorAll('.player-search-dropdown-item').forEach(item => {
            item.addEventListener('click', function() {
                const id = parseInt(this.dataset.id);
                const label = this.dataset.label;
                selectedUserId = id;
                hiddenInput.value = id;
                searchInput.value = label;
                dropdown.style.display = 'none';
                playerForm.submit();
            });
        });
    }
    
    // Handle input changes
    searchInput.addEventListener('input', function() {
        const query = this.value;
        filteredOptions = filterOptions(query);
        renderDropdown(filteredOptions);
    });
    
    // Handle focus
    searchInput.addEventListener('focus', function() {
        if (this.value.trim() === '') {
            filteredOptions = userOptions;
        } else {
            filteredOptions = filterOptions(this.value);
        }
        renderDropdown(filteredOptions);
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        const wrapper = searchInput.closest('.player-search-wrapper');
        if (wrapper && !wrapper.contains(e.target)) {
            dropdown.style.display = 'none';
        }
    });
    
    // Handle keyboard navigation
    searchInput.addEventListener('keydown', function(e) {
        const items = dropdown.querySelectorAll('.player-search-dropdown-item');
        const currentIndex = Array.from(items).findIndex(item => item.classList.contains('selected'));
        
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            const nextIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;
            items.forEach(item => item.classList.remove('selected'));
            if (items[nextIndex]) {
                items[nextIndex].classList.add('selected');
                items[nextIndex].scrollIntoView({ block: 'nearest' });
            }
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
            items.forEach(item => item.classList.remove('selected'));
            if (items[prevIndex]) {
                items[prevIndex].classList.add('selected');
                items[prevIndex].scrollIntoView({ block: 'nearest' });
            }
        } else if (e.key === 'Enter') {
            e.preventDefault();
            const selectedItem = dropdown.querySelector('.player-search-dropdown-item.selected');
            if (selectedItem) {
                selectedItem.click();
            } else if (items.length > 0) {
                items[0].click();
            }
        } else if (e.key === 'Escape') {
            dropdown.style.display = 'none';
        }
    });
    
});

document.addEventListener('click', async (event) => {
    const button = event.target.closest('[data-action="acknowledge"]');
    if (!button) return;
    const deliverableId = button.dataset.deliverableId;
    if (!deliverableId) return;

    button.disabled = true;
    button.textContent = 'Saving…';

    try {
        const response = await fetch(`/api/player/deliverables/${deliverableId}/acknowledge`, {
            method: 'POST',
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
            credentials: 'same-origin'
        });
        if (!response.ok) throw new Error('Request failed');
        button.textContent = 'Acknowledged';
        button.classList.add('btn-secondary');
        button.classList.remove('btn-primary');
    } catch (err) {
        button.textContent = 'Try again';
        button.disabled = false;
    }
});

// Countdown clock for next game
(function() {
    const countdownContainer = document.getElementById('game-countdown');
    if (!countdownContainer) return;

    const gameDateTimeIso = '{{ next_series.first_game_datetime_iso|default("")|safe }}';
    if (!gameDateTimeIso || gameDateTimeIso === 'None' || gameDateTimeIso === '') return;

    const countdownDays = document.getElementById('countdown-days');
    const countdownHours = document.getElementById('countdown-hours');
    const countdownMinutes = document.getElementById('countdown-minutes');
    
    if (!countdownDays || !countdownHours || !countdownMinutes) return;

    function updateCountdown() {
        try {
            const gameDate = new Date(gameDateTimeIso);
            const now = new Date();
            
            // Check if date is valid
            if (isNaN(gameDate.getTime())) {
                console.error('Invalid game date:', gameDateTimeIso);
                return;
            }
            
            const diff = gameDate - now;

            if (diff <= 0) {
                // Game has started or passed
                countdownDays.textContent = '00';
                countdownHours.textContent = '00';
                countdownMinutes.textContent = '00';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            countdownDays.textContent = String(days).padStart(2, '0');
            countdownHours.textContent = String(hours).padStart(2, '0');
            countdownMinutes.textContent = String(minutes).padStart(2, '0');
        } catch (e) {
            console.error('Error updating countdown:', e);
        }
    }

    // Update immediately
    updateCountdown();
    
    // Update every minute (60000ms) for smooth countdown
    setInterval(updateCountdown, 60000);
})();
</script>
{% endblock %}

